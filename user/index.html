<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User View</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div id="carEmojiHeader" class="emoji-header">ðŸš—</div>

    <h2>Enter Your Car Number</h2>

    <div id="inputSection">
      <input type="text" id="userIdInput" placeholder="Enter Your Car Number" />
      <button onclick="loadUser()">View</button>
    </div>

    <div id="userData" class="hidden">
      <h3 id="userName"></h3>
      <div class="progress-bar-container">
        <div id="progressBar" class="progress-bar-fill">0%</div>
      </div>
      <p id="messageArea"></p>
      <button class="reset-btn" onclick="resetView()">ðŸ”„ Reset View</button>
    </div>
  </div>

  <script>
    const SHEET_API = "https://script.google.com/macros/s/AKfycbwI0TOmTezlIu3cMblQ8_OSo4k5nOfTGPb_hF8jfzdKUZBq31imVuZBTAiKTaly_mw0uQ/exec";

    function loadUser() {
      const id = document.getElementById("userIdInput").value.trim();

      fetch(SHEET_API)
        .then(res => res.json())
        .then(users => {
          const user = users.find(u => u.id === id);
          if (user) {
            document.getElementById("inputSection").style.display = "none";
            document.getElementById("userData").classList.remove("hidden");

            document.getElementById("userName").innerText = `Welcome, ${user.name}`;

            const carEmoji = user.car || "ðŸš—";
            const carCount = parseInt(user.count) || 0;

            const emojiArea = document.getElementById("carEmojiHeader");
            emojiArea.innerHTML = carCount > 0 ? carEmoji.repeat(carCount) : carEmoji;

            const percentage = Math.min((carCount / 5) * 100, 100);
            const progressBar = document.getElementById("progressBar");
            progressBar.style.width = `${percentage}%`;
            progressBar.innerText = `${Math.round(percentage)}%`;

            document.getElementById("messageArea").innerText =
              carCount === 5 ? "ðŸŽ‰ Congratulations! One Car Wash Free!" : "";
          } else {
            alert("User not found!");
          }
        });
    }

    function resetView() {
      document.getElementById("userIdInput").value = "";
      document.getElementById("inputSection").style.display = "block";
      document.getElementById("userData").classList.add("hidden");
      document.getElementById("carEmojiHeader").innerHTML = "ðŸš—";
    }
  </script>
</body>
</html>
