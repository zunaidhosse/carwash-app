<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User View</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div id="languageToggle" class="lang-toggle">
      <button onclick="setLanguage('en')">🌐 English</button>
      <button onclick="setLanguage('ar')">🌐 Arabic</button>
    </div>

    <h2 id="enterTitle">Enter Your Car Number</h2>
    
    <div id="inputSection">
      <input type="text" id="userIdInput" placeholder="Enter Your Car Number" />
      <button onclick="loadUser()" id="viewBtn">View</button>
    </div>

    <div id="userData" class="hidden">
      <h3 id="userName"></h3>
      <div id="progressBarContainer" class="progress-container">
        <div id="progressBar" class="progress-bar"></div>
      </div>
      <div id="carsContainer" class="cars"></div>
      <p id="messageArea"></p>
      <p id="userMessage" class="user-msg"></p>
      <button onclick="resetView()" id="resetBtn">🔄 Reset View</button>
      <button onclick="showHistory()" id="historyBtn">🧾 Show Wash History</button>
    </div>
  </div>

  <!-- Modal for wash history -->
  <div id="historyModal" class="modal hidden">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3>🧾 Wash History</h3>
      <ul id="historyList"></ul>
    </div>
  </div>

  <script>
    let currentLang = 'en';

    const translations = {
      en: {
        title: "Enter Your Car Number",
        view: "View",
        reset: "🔄 Reset View",
        history: "🧾 Show Wash History",
        congrats: "🎉 Congratulations! One Car Wash Free!",
        notFound: "User not found!"
      },
      ar: {
        title: "أدخل رقم سيارتك",
        view: "عرض",
        reset: "🔄 إعادة",
        history: "🧾 عرض سجل الغسيل",
        congrats: "🎉 تهانينا! غسيل مجاني!",
        notFound: "المستخدم غير موجود!"
      }
    };

    function setLanguage(lang) {
      currentLang = lang;
      const t = translations[lang];
      document.getElementById("enterTitle").innerText = t.title;
      document.getElementById("viewBtn").innerText = t.view;
      document.getElementById("resetBtn").innerText = t.reset;
      document.getElementById("historyBtn").innerText = t.history;
      document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
    }

    function loadUser() {
      const id = document.getElementById("userIdInput").value.trim();
      const users = JSON.parse(localStorage.getItem("users") || "{}");
      const history = JSON.parse(localStorage.getItem("history") || "{}");

      if (users[id]) {
        const user = users[id];

        document.getElementById("inputSection").style.display = "none";
        document.getElementById("userData").classList.remove("hidden");
        document.getElementById("userName").innerText = `Welcome, ${user.name}`;

        // Show progress bar
        const progress = (user.count / 5) * 100;
        document.getElementById("progressBar").style.width = `${progress}%`;

        // Show cars
        const container = document.getElementById("carsContainer");
        container.innerHTML = "";
        for (let i = 1; i <= 5; i++) {
          const car = document.createElement("span");
          car.innerText = "🚗";
          car.style.opacity = i <= user.count ? "1" : "0.3";
          container.appendChild(car);
        }

        // Congratulatory message
        const message = document.getElementById("messageArea");
        message.innerText = user.count === 5 ? translations[currentLang].congrats : "";

        // Display user message (feedback)
        document.getElementById("userMessage").innerText = user.message || "";

        // Save current user ID for history
        localStorage.setItem("currentUser", id);
      } else {
        alert(translations[currentLang].notFound);
      }
    }

    function resetView() {
      document.getElementById("userIdInput").value = "";
      document.getElementById("inputSection").style.display = "block";
      document.getElementById("userData").classList.add("hidden");
    }

    function showHistory() {
      const id = localStorage.getItem("currentUser");
      const history = JSON.parse(localStorage.getItem("history") || "{}");
      const list = document.getElementById("historyList");
      list.innerHTML = "";

      if (history[id] && history[id].length > 0) {
        history[id].forEach(date => {
          const li = document.createElement("li");
          li.textContent = new Date(date).toLocaleString();
          list.appendChild(li);
        });
      } else {
        const li = document.createElement("li");
        li.textContent = "No history available.";
        list.appendChild(li);
      }

      document.getElementById("historyModal").classList.remove("hidden");
    }

    function closeModal() {
      document.getElementById("historyModal").classList.add("hidden");
    }

    // Initialize default language
    setLanguage('en');
  </script>
</body>
</html>
